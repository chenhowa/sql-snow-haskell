{
module Parser 
    ( parse

    ) where
}

%name parse
%tokentype { Token }
%error { parseError }

%token
    select                      { TokenSelect }
    from                        { TokenFrom }
    where                       { TokenWhere }
    groupBy                     { TokenGroupBy }
    having                      { TokenHaving }
    in                          { TokenIn }
    distinct                    { TokenDistinct }
    limit                       { TokenLimit }
    orderBy                     { TokenOrderBy }
    asc                         { TokenAscending }
    desc                        { TokenDescending }
    union                       { TokenUnion }
    intersect                   { TokenIntersect }
    all                         { TokenAll }
    left                        { TokenLeft }
    right                       { TokenRight }
    inner                       { TokenInner }
    outer                       { TokenOuter }
    natural                     { TokenNatural }
    join                        { TokenJoin }
    on                          { TokenOn }
    '+'                         { TokenPlus }
    '-'                         { TokenMinus }
    '*'                         { TokenAsterisk }
    '/'                         { TokenFloatDivide }
    '%'                         { TokenModulo }
    '='                         { TokenEquals }
    '!='                        { TokenNotEquals }
    '<'                         { TokenLT }
    '<='                        { TokenLTE }
    '>'                         { TokenGT }
    '>='                        { TokenGTE }
    not                         { TokenNot }
    and                         { TokenAnd }
    or                          { TokenOr }
    as                          { TokenAs }
    identifier                  { TokenIdentifier $$ }
    constant                    { TokenConstant $$ }
    '('                         { TokenRightParen }
    ')'                         { TokenLeftParen }
    ','                         { TokenComma }
    lc                          { TokenLineComment }
    bc                          { TokenBlockComment }


%%

Query           : Select
                | 

Select          : select '*'                    { Select Wildcard }
                | select Columns                { Select (Columns $2) }

Columns         : Column                        { [$1] }
                | Columns ',' Column            { $2 : $1 }

Column          : identifier                    { Column (Identifier $1) Nothing}
                | identifier Alias              { Column (Identifier $1) $2 }
                | Expr Alias                    { Column (Expr $1) $2 }

Alias           : identifier                    { Just $1 }
                | as identifier                 { Just $2 }

Expr            : Function                      { Expr $1 }
                | constant                      { Constant $1 }
                

Function        : identifier '(' Args ')'       { Function $1 $3 }

Args            : Arg                           { Arg [$1] }
                | Args ',' Arg                  { Args ($2:$1) }

Arg             : identifier                    { Identifier $1 }
                | Expr                          { $1 }

From            : from Tables                   { From $2 }

Tables          : Table                         { [$1] }
                | Tables ',' Table              { $2 : $1 }

Table           : identifier                    { Table $1 Nothing }
                | identifier Alias              { Table $1 $2 }

Where           : where














